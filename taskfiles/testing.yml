version: "3"

vars:
  TEST_DIR: "tests"
  RESULTS_DIR: "results"
  COVERAGE_DIR: "coverage"

tasks:
  test:
    desc: "Run all tests (unit, integration, smoke, e2e)"
    cmds:
      - task test:unit
      - task test:integration
      - task test:smoke
      - task test:e2e

  test:unit:
    desc: "Run unit tests"
    cmds:
      - pnpm test:unit

  test:integration:
    desc: "Run integration tests"
    cmds:
      - pnpm test:integration

  test:smoke:
    desc: "Run smoke tests"
    cmds:
      - pnpm test:smoke

  test:e2e:
    desc: "Run end-to-end tests"
    deps: [setup:playwright]
    cmds:
      - pnpm test:e2e

  upload-results:
    desc: "Upload test results to Codecov and Testspace"
    cmds:
      - task upload:codecov
      - task upload:testspace

  upload:codecov:
    desc: "Upload coverage to Codecov"
    cmds:
      - codecov --token {{.CODECOV_TOKEN}} --files {{.COVERAGE_DIR}}/*/clover.xml

  upload:testspace:
    desc: "Upload test results to Testspace"
    cmds:
      - testspace {{.RESULTS_DIR}}/*.xml {{.COVERAGE_DIR}}/*/clover.xml
